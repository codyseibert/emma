<html>
  <head>
    <title>TODO APP</title>
  </head>
    
  <body>
    <h1>TODO APP</h1>

    <div id="todo-items"></div>

    <input type="text" id="todo-text"/>
    <button id="save-btn">Save</button>

    <script type="module">
      import {html, render} from 'https://unpkg.com/lit-html?module';

      const saveBtn = document.getElementById('save-btn');
      const todoInput = document.getElementById('todo-text');
      const todoItems = window.scope.todos;

      const rerender = (todos) => {
        render(html`
          <ul>
            ${todos.map(todo => html`
              <li data-id="${todo._id}">${todo.text} <button @click=${(e) => deleteTodoItem(todo._id)}>Delete</button></li>
            `)}
          </ul>
        `, document.getElementById('todo-items'));
      };

      const deleteTodoItem = async (todoId) => {
        await fetch(`/api/todos/${todoId}`, {
          method: 'DELETE'
        })
        const todoItem = document.querySelector(`[data-id="${todoId}"]`);
        todoItem.remove();
      }

      saveBtn.addEventListener('click', async () => {
        const todoText = todoInput.value;
        const newTodo = await fetch('/api/todos', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            text: todoText,
            completed: false
          })
        }).then(res => res.json());
        todoItems.push(newTodo)
        rerender(todoItems);
      });

      rerender(todoItems);
    </script>
  </body>
</html>
