<html>
  <head>
    <title>TODO APP</title>

    
  </head>
  <body>
    <h1>TODO APP</h1>

    <div id="todo-items">

    </div>

    <input type="text" id="todo-text"/>
    <button id="save-btn">Save</button>

    <script>
      const saveBtn = document.getElementById('save-btn');
      const todoInput = document.getElementById('todo-text');

      const createTodoItem = (todo) => {
        const todoItem = document.createElement('div');
        todoItem.dataset.id = todo._id;
        todoItem.classList.add('todo-item');
        const deleteBtn = document.createElement('button');
        deleteBtn.innerText = 'Delete';
        deleteBtn.addEventListener('click', () => {
          deleteTodoItem(todo._id)
        });
        todoItem.append(todo.text);
        todoItem.appendChild(deleteBtn);
        return todoItem;
      }

      const deleteTodoItem = async (todoId) => {
        await fetch(`/api/todos/${todoId}`, {
          method: 'DELETE'
        })
        const todoItem = document.querySelector(`[data-id="${todoId}"]`);
        todoItem.remove();
      }

      const appendTodoItem = (todoEl) => {
        const todoItems = document.getElementById('todo-items');
        todoItems.appendChild(todoEl);
      }

      saveBtn.addEventListener('click', async () => {
        const todoText = todoInput.value;
        const newTodo = await fetch('/api/todos', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            text: todoText,
            completed: false
          })
        }).then(res => res.json());

        appendTodoItem(createTodoItem(newTodo));
      });

      for (let todo of window.scope.todos) {
        appendTodoItem(createTodoItem(todo));
      }
    </script>
  </body>
</html>
